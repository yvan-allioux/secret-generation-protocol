<!DOCTYPE html>
<html>
<head>
    <title>Interaction WebSocket</title>
</head>
<body>
    <h1>Interaction WebSocket</h1>

    <h2>Client</h2>
    <button id="startButton" disabled>Démarrer</button>
    <div id="status"></div>
    
    <h2>Obtenir le tableau</h2>
    <button id="getArrayButton" disabled>Obtenir</button>
    <div id="arrayResult"></div>
    
    <h2>Réinitialiser le tableau</h2>
    <button id="resetArrayButton" disabled>Réinitialiser</button>
    
    <script>
        const ws = new WebSocket("ws://localhost:8080/ws");
        const startButton = document.getElementById("startButton");
        const status = document.getElementById("status");
        const getArrayButton = document.getElementById("getArrayButton");
        const arrayResult = document.getElementById("arrayResult");
        const resetArrayButton = document.getElementById("resetArrayButton");

        ws.onopen = function(event) {
            console.log("Connexion WebSocket établie.");
            startButton.disabled = false;
            getArrayButton.disabled = false;
            resetArrayButton.disabled = false;
        };

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (typeof data === 'boolean') {
                status.textContent = "Les deux clients sont prêts.";
            } else if (Array.isArray(data)) {
                arrayResult.textContent = JSON.stringify(data);
            }
        };

        startButton.addEventListener("click", () => {
            ws.send(JSON.stringify({ client_pret: true }));
        });

        getArrayButton.addEventListener("click", () => {
            ws.send(JSON.stringify({ obtenir_tableau: true }));
        });

        resetArrayButton.addEventListener("click", () => {
            ws.send(JSON.stringify({ reset_tableau: true }));
        });

        ws.onerror = function(error) {
            console.log(`Erreur WebSocket : ${error.message}`);
        };

        ws.onclose = function(event) {
            console.log("Connexion WebSocket fermée.");
            startButton.disabled = true;
            getArrayButton.disabled = true;
            resetArrayButton.disabled = true;
        };
    </script>
</body>
</html>
